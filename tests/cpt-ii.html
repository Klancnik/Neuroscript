<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPT-II Enhanced v3.5</title>
    <script src="../neuroscript-norms.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            text-align: center;
        }
        .section-header {
            background-color: #34495e;
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            margin: 20px 0 10px 0;
            font-weight: bold;
            font-size: 16px;
        }
        .demo-section {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .demo-grid label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        .demo-grid input, .demo-grid select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .additional-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .additional-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .additional-grid label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        .additional-grid input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .info-note {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
        }
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        .score-table th {
            background-color: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        .score-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
        }
        .score-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .score-table input {
            width: 80px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
        }
        .elevated {
            color: #e74c3c;
            font-weight: bold;
        }
        .normal {
            color: #27ae60;
        }
        .save-btn {
            background-color: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .save-btn:hover {
            background-color: #2980b9;
        }
        .load-btn {
            background-color: #f39c12;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .load-btn:hover {
            background-color: #e67e22;
        }
        .output-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .output-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .warning strong {
            color: #d63031;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧠 CPT-II Enhanced v3.5</h1>
        
        <div class="demo-section">
            <div class="section-header">Client Demographics</div>
            <div style="display: grid; grid-template-columns: repeat(4, auto); gap: 15px; align-items: center; margin-top: 10px;">
                <label>Age:</label>
                <span id="age" style="padding: 4px 8px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; min-width: 40px; display: inline-block;">-</span>
                
                <label>Gender:</label>
                <span id="gender" style="padding: 4px 8px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; min-width: 60px; display: inline-block;">-</span>
                
                <label>Education (years):</label>
                <span id="education" style="padding: 4px 8px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; min-width: 40px; display: inline-block;">-</span>
                
                <label>Reading Level (grade):</label>
                <span id="readingLevel" style="padding: 4px 8px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; min-width: 40px; display: inline-block;">-</span>
            </div>
        </div>

        <div class="section-header">CPT-II T-Scores (From CPT-II Printout)</div>
        
        <table class="score-table">
            <thead>
                <tr>
                    <th>Measure</th>
                    <th>T-Score</th>
                    <th>Range</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Omissions</strong></td>
                    <td><input type="number" id="omissions" value="" placeholder="30-90" min="30" max="90" oninput="updateRangeDisplay('omissions')"></td>
                    <td id="omissions-range">-</td>
                </tr>
                <tr>
                    <td><strong>Commissions</strong></td>
                    <td><input type="number" id="commissions" value="" placeholder="30-90" min="30" max="90" oninput="updateRangeDisplay('commissions')"></td>
                    <td id="commissions-range">-</td>
                </tr>
                <tr>
                    <td><strong>Hit RT</strong></td>
                    <td><input type="number" id="hitRT" value="" placeholder="30-90" min="30" max="90" oninput="updateRangeDisplay('hitRT')"></td>
                    <td id="hitRT-range">-</td>
                </tr>
                <tr>
                    <td><strong>Hit RT SE</strong></td>
                    <td><input type="number" id="hitRTSE" value="" placeholder="30-90" min="30" max="90" oninput="updateRangeDisplay('hitRTSE')"></td>
                    <td id="hitRTSE-range">-</td>
                </tr>
                <tr>
                    <td><strong>Variability</strong></td>
                    <td><input type="number" id="variability" value="" placeholder="30-90" min="30" max="90" oninput="updateRangeDisplay('variability')"></td>
                    <td id="variability-range">-</td>
                </tr>
                <tr>
                    <td><strong>Detectability (d')</strong></td>
                    <td><input type="number" id="detectability" value="" placeholder="30-90" min="30" max="90" oninput="updateRangeDisplay('detectability')"></td>
                    <td id="detectability-range">-</td>
                </tr>
            </tbody>
        </table>

        <div class="additional-section">
            <div class="section-header">Additional Measures (Optional)</div>
            <div class="additional-grid">
                <div>
                    <label>Response Style β:</label>
                    <input type="number" id="responseStyle" value="" placeholder="Response bias" step="0.01">
                </div>
                <div>
                    <label>Perseverations:</label>
                    <input type="number" id="perseverations" value="" placeholder="0+" min="0">
                </div>
            </div>
        </div>

        <div class="info-note">
            <strong>Note:</strong> Higher T-scores on CPT-II indicate worse performance (inverted scoring). Range displays reflect this CPT-II convention.
        </div>

        <button class="load-btn" onclick="loadTestData()">Load Test Data</button>
        <button class="save-btn" onclick="saveTestData()">Save Test Data</button>

        <div id="output" class="output-section" style="display:none;">
            <!-- Generated report will appear here -->
        </div>
    </div>

    <script>
        console.log('CPT-II Enhanced v3.6 - Initializing...');
        
        // === GLOBAL VARIABLES ===
        let currentNarrative = '';
        let currentScoreTable = '';

        // === ALL FUNCTION DEFINITIONS FIRST ===
        
        // CPT Error Descriptors from statconv file
        function getCPTErrorDescriptor(tScore) {
            console.log('getCPTErrorDescriptor v3.6 called with T-score:', tScore);
            
            if (tScore < 30) return "very few";
            if (tScore >= 30 && tScore <= 36) return "a well below average number";
            if (tScore >= 37 && tScore <= 44) return "a fewer than average number";
            if (tScore >= 45 && tScore <= 56) return "an average number";
            if (tScore >= 57 && tScore <= 68) return "a higher than average number";
            if (tScore >= 69 && tScore <= 72) return "a significantly higher than average number";
            if (tScore >= 73) return "a very significantly higher than average number";
            
            return "an average number"; // fallback
        }

        // CPT Speed Descriptors from statconv file  
        function getCPTSpeedDescriptor(tScore) {
            console.log('getCPTSpeedDescriptor v3.6 called with T-score:', tScore);
            
            if (tScore < 30) return "very significantly faster than average";
            if (tScore >= 30 && tScore <= 36) return "significantly faster than average";
            if (tScore >= 37 && tScore <= 44) return "faster than average";
            if (tScore >= 45 && tScore <= 56) return "average";
            if (tScore >= 57 && tScore <= 68) return "slower than average";
            if (tScore >= 69 && tScore <= 72) return "significantly slower than average";
            if (tScore >= 73) return "very significantly slower than average";
            
            return "average"; // fallback
        }

        // Convert CPT T-score to conventional T-score for AACN lookup
        function convertCPTToConventionalT(cptTScore) {
            return 100 - cptTScore;
        }

        // Get conventional T-score to percentile conversion
        function convertTScoreToPercentile(tScore) {
            console.log('convertTScoreToPercentile v3.6 called with T-score:', tScore);
            
            try {
                if (typeof window.NeuroscriptDB === 'undefined') {
                    console.error('NeuroscriptDB not available');
                    return 50; // fallback
                }

                const data = window.NeuroscriptDB.getByTScore(tScore);
                if (data && data.percentile !== undefined) {
                    console.log('Found percentile from database:', data.percentile);
                    return data.percentile;
                }

                // Fallback approximation if database lookup fails
                console.warn('Database lookup failed, using fallback approximation');
                if (tScore <= 20) return 0.1;
                if (tScore <= 30) return 2;
                if (tScore <= 35) return 7;
                if (tScore <= 40) return 16;
                if (tScore <= 45) return 31;
                if (tScore <= 55) return 50;
                if (tScore <= 60) return 69;
                if (tScore <= 65) return 84;
                if (tScore <= 70) return 93;
                if (tScore <= 80) return 98;
                return 99.9;

            } catch (error) {
                console.error('Error in convertTScoreToPercentile v3.6:', error);
                return 50; // fallback
            }
        }

        // Get AACN Range for converted T-score
        function getAACNRange(conventionalTScore) {
            console.log('getAACNRange v3.6 called with conventional T-score:', conventionalTScore);
            
            try {
                if (typeof window.NeuroscriptDB === 'undefined') {
                    console.error('NeuroscriptDB not available');
                    return "Average"; // fallback
                }

                const data = window.NeuroscriptDB.getByTScore(conventionalTScore);
                if (data && data.aacnLabel) {
                    console.log('Found AACN label from database:', data.aacnLabel);
                    return data.aacnLabel;
                }

                // Fallback - should not happen with proper database
                console.warn('Database lookup failed for AACN range');
                const percentile = convertTScoreToPercentile(conventionalTScore);
                if (percentile <= 2) return "Exceptionally Low";
                if (percentile <= 9) return "Low Average";
                if (percentile <= 25) return "Below Average";
                if (percentile <= 75) return "Average";
                if (percentile <= 89) return "High Average";
                if (percentile <= 97) return "Above Average";
                return "Exceptionally High";

            } catch (error) {
                console.error('Error in getAACNRange v3.6:', error);
                return "Average"; // fallback
            }
        }

        // Display real-time range updates  
        function updateRangeDisplay(fieldId) {
            console.log('updateRangeDisplay v3.6 called for field:', fieldId);
            
            const tScore = parseInt(document.getElementById(fieldId).value);
            const rangeCell = document.getElementById(fieldId + '-range');
            
            if (isNaN(tScore) || tScore < 30 || tScore > 90) {
                rangeCell.textContent = '-';
                rangeCell.className = '';
                return;
            }

            const conventionalTScore = convertCPTToConventionalT(tScore);
            const range = getAACNRange(conventionalTScore);
            
            rangeCell.textContent = range;
            
            // Color coding: higher CPT T-scores = worse performance = red
            if (tScore >= 65) {
                rangeCell.className = 'elevated';
            } else {
                rangeCell.className = 'normal';
            }
        }

        // Test data loading function
        function loadTestData() {
            console.log('loadTestData v3.6 called');
            
            // Load demographics
            document.getElementById('age').textContent = 28;
            document.getElementById('gender').textContent = 'Male';
            document.getElementById('education').textContent = 16;
            document.getElementById('readingLevel').textContent = 12;
            
            // Load CPT-II scores with real values from actual report
            document.getElementById('omissions').value = 73;
            document.getElementById('commissions').value = 65;
            document.getElementById('hitRT').value = 58;
            document.getElementById('hitRTSE').value = 62;
            document.getElementById('variability').value = 69;
            document.getElementById('detectability').value = 61;
            document.getElementById('perseverations').value = 2;
            
            // Update range displays
            updateRangeDisplay('omissions');
            updateRangeDisplay('commissions');
            updateRangeDisplay('hitRT');
            updateRangeDisplay('hitRTSE');
            updateRangeDisplay('variability');
            updateRangeDisplay('detectability');
        }

        // Consolidated Save Test Data function
        function saveTestData() {
            console.log('saveTestData v3.6 called');
            
            try {
                // Database validation
                if (typeof window.NeuroscriptDB === 'undefined') {
                    alert('Database not loaded. Please refresh the page and try again.');
                    return;
                }

                // Data collection
                const data = {
                    age: parseInt(document.getElementById('age').textContent),
                    gender: document.getElementById('gender').textContent,
                    education: parseInt(document.getElementById('education').textContent) || 0,
                    readingLevel: parseFloat(document.getElementById('readingLevel').textContent) || 0,
                    omissions: parseInt(document.getElementById('omissions').value),
                    commissions: parseInt(document.getElementById('commissions').value),
                    hitRT: parseInt(document.getElementById('hitRT').value),
                    hitRTSE: parseInt(document.getElementById('hitRTSE').value),
                    variability: parseInt(document.getElementById('variability').value),
                    detectability: parseInt(document.getElementById('detectability').value),
                    responseStyle: parseFloat(document.getElementById('responseStyle').value) || 0,
                    perseverations: parseInt(document.getElementById('perseverations').value) || 0
                };

                console.log('Collected CPT-II data v3.6:', data);

                // Validation - CPT requires all core scores
                if (!data.age || !data.gender) {
                    alert('Please enter age and gender before saving test data.');
                    return;
                }

                if (!data.omissions || !data.commissions || !data.hitRT || !data.hitRTSE || !data.variability || !data.detectability) {
                    alert('Please enter all required CPT-II T-scores before saving test data.');
                    return;
                }

                // Generate validation warnings
                const warnings = [];
                if (data.age < 6 || data.age > 90) {
                    warnings.push("⚠️ Age outside CPT-II normative range (6-90 years)");
                }

                const gender = data.gender;
                const pronoun = gender === 'Male' ? 'his' : 'her';
                const heShe = gender === 'Male' ? 'he' : 'she';
                const hisHer = gender === 'Male' ? 'His' : 'Her';

                // 5-Step Enhanced Narrative Structure
                let report = '<h3>CPT-II Clinical Narrative</h3>';
                
                // Step 1: Introduction & Test Paradigm
                report += '<p>The Continuous Performance Test-II (CPT-II) is a computerized measure of sustained attention that assesses an individual\'s ability to maintain focus and inhibit inappropriate responses during a prolonged, monotonous task. The test requires the examinee to respond to target letters while withholding responses to non-target letters presented rapidly across a 14-minute administration period.</p>';

                // Step 2: Detectability Analysis  
                const conventionalDetectT = convertCPTToConventionalT(data.detectability);
                const detectRange = getAACNRange(conventionalDetectT);
                const detectPercentile = convertTScoreToPercentile(conventionalDetectT);
                
                report += `<p><strong>Signal Detection Analysis:</strong> ${hisHer} detectability (d') score fell within the ${detectRange} range (${detectPercentile}th percentile), indicating ${heShe} demonstrated `;
                
                if (detectPercentile >= 75) {
                    report += 'strong signal detection capability, effectively discriminating between target and non-target stimuli throughout the sustained attention task.';
                } else if (detectPercentile >= 25) {
                    report += 'adequate signal detection capability, with generally appropriate discrimination between target and non-target stimuli.';
                } else {
                    report += 'reduced signal detection capability, suggesting difficulty discriminating between target and non-target stimuli during the sustained attention task.';
                }
                report += '</p>';

                // Step 3: Error Analysis (Omissions & Commissions)
                const omissionDescriptor = getCPTErrorDescriptor(data.omissions);
                const commissionDescriptor = getCPTErrorDescriptor(data.commissions);
                
                report += `<p><strong>Error Analysis:</strong> ${heShe} made ${omissionDescriptor} of omission errors and ${commissionDescriptor} of commission errors. `;
                
                // Pattern recognition for inattention vs impulsivity
                const omissionDominant = data.omissions > data.commissions + 10;
                const commissionDominant = data.commissions > data.omissions + 10;
                
                if (omissionDominant && data.omissions >= 65) {
                    report += 'This pattern of predominantly omission errors suggests difficulties with sustained attention and vigilance, characteristic of inattentive presentations.';
                } else if (commissionDominant && data.commissions >= 65) {
                    report += 'This pattern of predominantly commission errors suggests difficulties with response inhibition and impulse control, characteristic of hyperactive-impulsive presentations.';
                } else if (data.omissions >= 65 && data.commissions >= 65) {
                    report += 'The elevated levels of both omission and commission errors suggest a combined pattern of attention and impulse control difficulties.';
                } else if (data.omissions < 55 && data.commissions < 55) {
                    report += 'The low error rates across both types suggest good sustained attention and response inhibition capabilities.';
                } else {
                    report += 'The error pattern suggests mild difficulties with sustained attention task performance.';
                }
                report += '</p>';

                // Step 4: Response Speed Analysis
                const rtDescriptor = getCPTSpeedDescriptor(data.hitRT);
                const rtseDescriptor = getCPTSpeedDescriptor(data.hitRTSE);
                const variabilityDescriptor = getCPTSpeedDescriptor(data.variability);
                
                report += `<p><strong>Response Speed Analysis:</strong> ${hisHer} hit reaction time was ${rtDescriptor}, with ${rtseDescriptor} standard error and ${variabilityDescriptor} variability. `;
                
                if (data.hitRT >= 65 || data.variability >= 65) {
                    report += 'The slower and/or more variable response pattern may indicate reduced processing speed or inconsistent engagement with the task demands.';
                } else if (data.hitRT <= 45) {
                    report += 'The faster response pattern suggests good processing speed, though this should be considered alongside error rates for comprehensive interpretation.';
                } else {
                    report += 'The response speed pattern falls within typical ranges for sustained attention tasks.';
                }
                report += '</p>';

                // Step 5: Clinical Integration & Interpretation
                report += '<p><strong>Clinical Integration:</strong> ';
                
                // Overall performance classification
                const elevatedCount = [data.omissions, data.commissions, data.hitRT, data.hitRTSE, data.variability].filter(score => score >= 65).length;
                const clinicalCount = [data.omissions, data.commissions].filter(score => score >= 65).length;
                
                if (elevatedCount >= 3) {
                    report += 'The pattern of performance across multiple CPT-II measures suggests significant difficulties with sustained attention, consistent with attentional dysfunction that may warrant further clinical evaluation and intervention consideration.';
                } else if (clinicalCount >= 1) {
                    report += 'The elevated error rates suggest mild to moderate difficulties with sustained attention that may impact daily functioning and academic or occupational performance.';
                } else {
                    report += 'Overall performance on the CPT-II was within normal limits, indicating adequate sustained attention capabilities under controlled testing conditions.';
                }

                // Perseverations note if elevated
                if (data.perseverations >= 3) {
                    report += ' The number of identified perseverative responses are outside of normal limits. As, on this test, this could be due to a number of different factors, the attending psychologist should review the raw data to make a determination.';
                }

                report += '</p>';

                // Store narrative
                currentNarrative = report.replace(/<[^>]*>/g, '').trim();

                // Create score summary table with dual metric system
                const scoreData = [
                    ['CPT-II Measure', 'T-Score (CPT)', 'Conventional Range'],
                    ['Omissions', data.omissions, getAACNRange(convertCPTToConventionalT(data.omissions))],
                    ['Commissions', data.commissions, getAACNRange(convertCPTToConventionalT(data.commissions))],
                    ['Hit RT', data.hitRT, getAACNRange(convertCPTToConventionalT(data.hitRT))],
                    ['Hit RT SE', data.hitRTSE, getAACNRange(convertCPTToConventionalT(data.hitRTSE))],
                    ['Variability', data.variability, getAACNRange(convertCPTToConventionalT(data.variability))],
                    ['Detectability (d\')', data.detectability, getAACNRange(convertCPTToConventionalT(data.detectability))]
                ];

                currentScoreTable = scoreData;

                // Create table HTML
                report += `
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <tr style="background-color: #f8f9fa;">
                        <th style="padding: 8px; text-align: left; border: 1px solid #ddd;">Measure</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">T-Score</th>
                        <th style="padding: 8px; text-align: center; border: 1px solid #ddd;">Range</th>
                    </tr>
                    ${scoreData.slice(1).map(row => `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${row[0]}</td>
                            <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${row[1]}</td>
                            <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${row[2]}</td>
                        </tr>
                    `).join('')}
                </table>
                `;

                // Display the report
                document.getElementById('output').innerHTML = report;

                // Add validation warnings if any
                if (warnings.length > 0) {
                    document.getElementById('output').innerHTML += `<div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin-top: 20px;">`;
                    document.getElementById('output').innerHTML += `<h4><b>⚠️ Validation Alerts</b></h4>`;
                    warnings.forEach(warning => {
                        document.getElementById('output').innerHTML += `<p style="margin: 5px 0;">${warning}</p>`;
                    });
                    document.getElementById('output').innerHTML += `</div>`;
                }

                document.getElementById('output').style.display = 'block';

                // Send to master dashboard
                const results = {
                    narrative: currentNarrative,
                    scoreTable: currentScoreTable,
                    testName: 'CPT-II',
                    completedAt: new Date().toISOString()
                };
                
                window.parent.postMessage({
                    type: 'testComplete',
                    testName: 'cpt-ii',
                    results: results
                }, '*');
                
                console.log('CPT-II test data saved successfully to dashboard v3.6');
                
            } catch (error) {
                console.error('Error saving test data v3.6:', error);
                document.getElementById('output').innerHTML = `<p><strong>Error saving test data:</strong> ${error.message}</p>`;
                document.getElementById('output').style.display = 'block';
            }
        }

        // === EVENT HANDLERS AND INITIALIZATION ===
        window.addEventListener('message', function(event) {
            console.log('Message received in CPT-II v3.6:', event.data);
            if (event.data.type === 'clientInfo') {
                const clientData = event.data.data;
                if (clientData.age) document.getElementById('age').textContent = clientData.age;
                if (clientData.gender) document.getElementById('gender').textContent = clientData.gender;
                if (clientData.education) document.getElementById('education').textContent = clientData.education;
                if (clientData.readingLevel) document.getElementById('readingLevel').textContent = clientData.readingLevel;
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CPT-II v3.6 loaded successfully');
            
            // Database loading check
            if (typeof window.NeuroscriptDB === 'undefined') {
                console.error('NeuroscriptDB not loaded in CPT-II v3.6!');
                setTimeout(() => {
                    if (typeof window.NeuroscriptDB === 'undefined') {
                        alert('Database loading error. Please refresh the page.');
                    }
                }, 2000);
            } else {
                console.log('NeuroscriptDB loaded successfully in CPT-II v3.6');
            }
        });
    </script>
</body>
</html>
